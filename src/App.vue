<script setup>
import {onMounted, ref, reactive, nextTick} from "vue";
import LineItem from "@/components/LineItem.vue";
import Recorder from 'js-audio-recorder'
import EVENT_BUS from "./event";
import {events} from 'fetch-event-stream'
import {config} from "./config";

const apiUrl = 'http://localhost:4242'

let historyRef = reactive({
  value: []
})

const message = ref()
const recording = ref(0)
const communicating = ref(false);
const isVertical = ref(window.innerHeight > window.innerWidth)

let recorder = new Recorder()

const onBtnRecordClick = () => {
  if (recording.value) {
    stopRecording()
  } else {
    startRecording()
  }
}

const onBtnSendClick = async () => {
  if (communicating.value) {
    console.log("communicating")
    return
  }

  try {
    const val = message.value
    message.value = ""

    const formData = new FormData()
    formData.append('aia', config.id)
    formData.append('message', val)
    communicating.value = true

    historyRef.value.push({
      from: 'user',
      text: val,
    })

    const response = {
      from: 'assistant',
      text: '',
      state: 'pending'
    }
    historyRef.value.push(response)

    historyRef.value = [...historyRef.value]

    nextTick(() => {
      lineBottom.scrollIntoView({behavior: "smooth"})
    })

    let res = await fetch(`${apiUrl}/completions/stream`, {
      method: 'POST',
      body: formData
    })

    if (res.ok) {
      await handle_stream(res, response, true)
    } else {
      console.log('HTTP-Error: ' + res.status);
    }
    communicating.value = false
  } catch (e) {
    console.error(`fetchEventSource: error ${e}`)
    communicating.value = false
  }
}

const startRecording = async () => {
  if (communicating.value) {
    console.log("communicating")
    return
  }

  console.log("start recording")
  try {
    await recorder.start()
    const now = Date.now()
    recording.value = now

    setTimeout(() => {
      try {
        if (recording.value === now) {
          stopRecording()
        }
      } catch (e) {
        console.log(e)
      }
    }, 10000)
  } catch (e) {
    console.error(e)
  }
}

const stopRecording = async () => {
  recording.value = 0
  try {
    const audio = await recorder.getWAVBlob()

    const formData = new FormData()
    formData.append('aia', config.id)
    formData.append('audio', audio, 'audio.wav')

    historyRef.value.push({
      from: 'user',
      text: undefined,
      state: 'pending'
    })
    historyRef.value = [...historyRef.value]
    nextTick(() => {
      lineBottom.scrollIntoView({
        behavior: "smooth"
      })
    })

    communicating.value = true
    let res = await fetch(`${apiUrl}/completions/stream/audio`, {
      method: 'POST',
      body: formData
    })

    if (res.ok) {
      await handle_stream(res)
    } else {
      console.log('HTTP-Error: ' + res.status);
    }

    communicating.value = false
  } catch (e) {
    console.error(e)
  }
}

async function handle_stream(res, response, pushed) {
  const curResponse = response || {
    from: 'assistant',
    text: '',
    audio: null,
    state: 'pending'
  }

  let responsePushed = pushed
  let stream = await events(res, null);
  for await (let event of stream) {
    const data = JSON.parse(event.data)
    switch (data.from) {
      case 'assistant': {
        switch (data.type) {
          case 'emotion' : {
            console.log(`emotion is: ${data.emotion}`)
            EVENT_BUS.emit("emotion", data.emotion);
          }
            break
          case 'token': {
            console.log(JSON.stringify(data))
            if (!responsePushed) {
              historyRef.value.push(curResponse)
              responsePushed = true
            }

            curResponse.text += data.text
            historyRef.value[historyRef.value.length - 1] = {
              text: curResponse.text,
              from: curResponse.from,
              audio: curResponse.audio,
              state: (curResponse.text && curResponse.text.length > 0) ? undefined : curResponse.state
            }
            historyRef.value = [...historyRef.value]
            nextTick(() => {
              lineBottom.scrollIntoView({behavior: "smooth"})
            })
          }
            break;
          case 'audio': {
            curResponse.audio = data.audio
            historyRef.value[historyRef.value.length - 1] = {
              text: curResponse.text,
              from: curResponse.from,
              audio: curResponse.audio
            }
            historyRef.value = [...historyRef.value]
          }
        }
      }
        break;
      case 'user': {
        const userMessages = historyRef.value.filter(i => i.from === 'user' && i.state === 'pending')
        if (userMessages.length !== 0) {
          const last = userMessages[userMessages.length - 1]
          last.state = undefined
          last.text = data.text

          historyRef.value.push(curResponse)
          responsePushed = true
          historyRef.value = [...historyRef.value]
        }
        break
      }
      case 'notification': {
        historyRef.value.push({
          from: 'notification',
          text: data.text
        })
        break
      }
    }
  }
}

let lineBottom
let roleName = ref('')
onMounted(async () => {
  lineBottom = document.getElementById('linebottom')
  roleName.value = config.name
})
</script>

<template>
  <n-flex :class="isVertical? `vertical`: `horizontal`">
    <div class="header">

      <img src="/public/assets/logo.png">
    </div>
    <div class="model-div">
      <canvas id="canvas" class="galacean"></canvas>
    </div>
    <n-flex justify="center" size="large" class="ui">
      <n-flex class="chat-panel" vertical>
        <n-flex class="char-name" :align="center" :justify="start">
          <n-avatar :src="config.avatar" round style="height: 2em; width: 2em;"></n-avatar>
          <n-space></n-space>
          <span style="font-size: 1.5em">{{ roleName }}</span>
          <div style="background-color: #FFFFFF22;width: calc(100% - 2em); height: 1px"></div>
        </n-flex>
        <div class="history-container">
          <div style="display: flex; flex-direction: column; justify-content: left; gap: 1em;">
            <LineItem v-for="line in historyRef.value" :history-item="line"></LineItem>
            <div id="linebottom"/>
          </div>
        </div>
        <n-flex size="large" vertical class="input-container">
          <input @keyup.enter="onBtnSendClick" type="text" v-model="message" placeholder="Your message"/>
          <n-flex justify="space-between" class="tools">
            <n-flex justify="">
              <n-button type="primary" color="#00000000" @click="onBtnRecordClick"
                        :disabled="communicating">
                <svg v-if="!recording" width="20" height="20" viewBox="0 0 20 20" fill="none"
                     xmlns="http://www.w3.org/2000/svg">
                  <path
                      d="M9.99984 11.6665C9.30539 11.6665 8.71512 11.4234 8.229 10.9373C7.74289 10.4512 7.49984 9.86095 7.49984 9.1665V4.1665C7.49984 3.47206 7.74289 2.88178 8.229 2.39567C8.71512 1.90956 9.30539 1.6665 9.99984 1.6665C10.6943 1.6665 11.2846 1.90956 11.7707 2.39567C12.2568 2.88178 12.4998 3.47206 12.4998 4.1665V9.1665C12.4998 9.86095 12.2568 10.4512 11.7707 10.9373C11.2846 11.4234 10.6943 11.6665 9.99984 11.6665ZM9.1665 17.4998V14.9373C7.72206 14.7429 6.52762 14.0971 5.58317 12.9998C4.63873 11.9026 4.1665 10.6248 4.1665 9.1665H5.83317C5.83317 10.3193 6.23942 11.3019 7.05192 12.1144C7.86442 12.9269 8.84706 13.3332 9.99984 13.3332C11.1526 13.3332 12.1353 12.9269 12.9478 12.1144C13.7603 11.3019 14.1665 10.3193 14.1665 9.1665H15.8332C15.8332 10.6248 15.3609 11.9026 14.4165 12.9998C13.4721 14.0971 12.2776 14.7429 10.8332 14.9373V17.4998H9.1665Z"
                      fill="white"/>
                </svg>
                <svg v-else width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <g clip-path="url(#clip0_1755_8476)">
                    <path
                        d="M6.66675 19.9998C6.43064 19.9998 6.23272 19.92 6.073 19.7603C5.91328 19.6005 5.83341 19.4026 5.83341 19.1665C5.83341 18.9304 5.91328 18.7325 6.073 18.5728C6.23272 18.413 6.43064 18.3332 6.66675 18.3332C6.90286 18.3332 7.10078 18.413 7.2605 18.5728C7.42022 18.7325 7.50008 18.9304 7.50008 19.1665C7.50008 19.4026 7.42022 19.6005 7.2605 19.7603C7.10078 19.92 6.90286 19.9998 6.66675 19.9998ZM10.0001 19.9998C9.76397 19.9998 9.56605 19.92 9.40633 19.7603C9.24661 19.6005 9.16675 19.4026 9.16675 19.1665C9.16675 18.9304 9.24661 18.7325 9.40633 18.5728C9.56605 18.413 9.76397 18.3332 10.0001 18.3332C10.2362 18.3332 10.4341 18.413 10.5938 18.5728C10.7536 18.7325 10.8334 18.9304 10.8334 19.1665C10.8334 19.4026 10.7536 19.6005 10.5938 19.7603C10.4341 19.92 10.2362 19.9998 10.0001 19.9998ZM13.3334 19.9998C13.0973 19.9998 12.8994 19.92 12.7397 19.7603C12.5799 19.6005 12.5001 19.4026 12.5001 19.1665C12.5001 18.9304 12.5799 18.7325 12.7397 18.5728C12.8994 18.413 13.0973 18.3332 13.3334 18.3332C13.5695 18.3332 13.7674 18.413 13.9272 18.5728C14.0869 18.7325 14.1667 18.9304 14.1667 19.1665C14.1667 19.4026 14.0869 19.6005 13.9272 19.7603C13.7674 19.92 13.5695 19.9998 13.3334 19.9998ZM10.0001 11.6665C9.30564 11.6665 8.71536 11.4234 8.22925 10.9373C7.74314 10.4512 7.50008 9.86095 7.50008 9.1665V4.1665C7.50008 3.47206 7.74314 2.88178 8.22925 2.39567C8.71536 1.90956 9.30564 1.6665 10.0001 1.6665C10.6945 1.6665 11.2848 1.90956 11.7709 2.39567C12.257 2.88178 12.5001 3.47206 12.5001 4.1665V9.1665C12.5001 9.86095 12.257 10.4512 11.7709 10.9373C11.2848 11.4234 10.6945 11.6665 10.0001 11.6665ZM9.16675 17.4998V14.9165C7.7223 14.7221 6.52786 14.0797 5.58341 12.9894C4.63897 11.8991 4.16675 10.6248 4.16675 9.1665H5.83341C5.83341 10.3193 6.23966 11.3019 7.05216 12.1144C7.86466 12.9269 8.8473 13.3332 10.0001 13.3332C11.1529 13.3332 12.1355 12.9269 12.948 12.1144C13.7605 11.3019 14.1667 10.3193 14.1667 9.1665H15.8334C15.8334 10.6248 15.3612 11.8991 14.4167 12.9894C13.4723 14.0797 12.2779 14.7221 10.8334 14.9165V17.4998H9.16675Z"
                        fill="#FF6187"/>
                  </g>
                  <defs>
                    <clipPath id="clip0_1755_8476">
                      <rect width="20" height="20" fill="white"/>
                    </clipPath>
                  </defs>
                </svg>


              </n-button>
            </n-flex>
            <n-button type="primary" @click="onBtnSendClick" color="#2b2e36">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 20V14L11 12L3 10V4L22 12L3 20Z" fill="white"/>
              </svg>
            </n-button>
          </n-flex>
        </n-flex>
      </n-flex>
    </n-flex>
    <div class="footer">
      <svg width="343" height="30" viewBox="0 0 343 30" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect width="343" height="30" fill="none"/>
        <g opacity="0.5">
          <path
              d="M109.469 13.0653C109.423 12.6619 109.236 12.3494 108.906 12.1278C108.577 11.9034 108.162 11.7912 107.662 11.7912C107.304 11.7912 106.994 11.848 106.733 11.9616C106.472 12.0724 106.268 12.2259 106.124 12.4219C105.982 12.6151 105.911 12.8352 105.911 13.0824C105.911 13.2898 105.959 13.4687 106.055 13.6193C106.155 13.7699 106.284 13.8963 106.443 13.9986C106.605 14.098 106.778 14.1818 106.963 14.25C107.148 14.3153 107.325 14.3693 107.496 14.4119L108.348 14.6335C108.626 14.7017 108.912 14.794 109.205 14.9105C109.497 15.027 109.768 15.1804 110.018 15.3707C110.268 15.5611 110.47 15.7969 110.624 16.0781C110.78 16.3594 110.858 16.696 110.858 17.0881C110.858 17.5824 110.73 18.0213 110.474 18.4048C110.222 18.7884 109.854 19.0909 109.371 19.3125C108.891 19.5341 108.31 19.6449 107.628 19.6449C106.974 19.6449 106.409 19.5412 105.932 19.3338C105.455 19.1264 105.081 18.8324 104.811 18.4517C104.541 18.0682 104.392 17.6136 104.364 17.0881H105.685C105.71 17.4034 105.813 17.6662 105.991 17.8764C106.173 18.0838 106.405 18.2386 106.686 18.3409C106.97 18.4403 107.281 18.4901 107.619 18.4901C107.991 18.4901 108.322 18.4318 108.612 18.3153C108.905 18.196 109.135 18.0312 109.303 17.821C109.47 17.608 109.554 17.3594 109.554 17.0753C109.554 16.8168 109.48 16.6051 109.332 16.4403C109.188 16.2756 108.99 16.1392 108.74 16.0312C108.493 15.9233 108.213 15.8281 107.901 15.7457L106.869 15.4645C106.17 15.2741 105.616 14.9943 105.207 14.625C104.801 14.2557 104.598 13.767 104.598 13.1591C104.598 12.6562 104.734 12.2173 105.007 11.8423C105.28 11.4673 105.649 11.1761 106.115 10.9688C106.581 10.7585 107.107 10.6534 107.692 10.6534C108.283 10.6534 108.804 10.7571 109.256 10.9645C109.71 11.1719 110.068 11.4574 110.33 11.821C110.591 12.1818 110.727 12.5966 110.739 13.0653H109.469ZM116.475 16.7855V12.9545H117.754V19.5H116.501V18.3665H116.433C116.282 18.7159 116.041 19.0071 115.708 19.2401C115.379 19.4702 114.968 19.5852 114.477 19.5852C114.056 19.5852 113.684 19.4929 113.36 19.3082C113.039 19.1207 112.787 18.8438 112.602 18.4773C112.42 18.1108 112.329 17.6577 112.329 17.1179V12.9545H113.603V16.9645C113.603 17.4105 113.727 17.7656 113.974 18.0298C114.221 18.294 114.542 18.4261 114.937 18.4261C115.176 18.4261 115.413 18.3665 115.649 18.2472C115.887 18.1278 116.085 17.9474 116.241 17.706C116.4 17.4645 116.478 17.1577 116.475 16.7855ZM119.466 21.9545V12.9545H120.71V14.0156H120.817C120.891 13.8793 120.997 13.7216 121.136 13.5426C121.276 13.3636 121.469 13.2074 121.716 13.0739C121.963 12.9375 122.29 12.8693 122.696 12.8693C123.224 12.8693 123.696 13.0028 124.111 13.2699C124.526 13.5369 124.851 13.9219 125.087 14.4247C125.325 14.9276 125.445 15.5327 125.445 16.2401C125.445 16.9474 125.327 17.554 125.091 18.0597C124.855 18.5625 124.531 18.9503 124.119 19.223C123.707 19.4929 123.237 19.6278 122.709 19.6278C122.311 19.6278 121.986 19.5611 121.733 19.4276C121.483 19.294 121.287 19.1378 121.145 18.9588C121.003 18.7798 120.893 18.6207 120.817 18.4815H120.74V21.9545H119.466ZM120.714 16.2273C120.714 16.6875 120.781 17.0909 120.915 17.4375C121.048 17.7841 121.241 18.0554 121.494 18.2514C121.747 18.4446 122.057 18.5412 122.423 18.5412C122.804 18.5412 123.122 18.4403 123.378 18.2386C123.634 18.0341 123.827 17.7571 123.957 17.4077C124.091 17.0582 124.158 16.6648 124.158 16.2273C124.158 15.7955 124.092 15.4077 123.962 15.0639C123.834 14.7202 123.641 14.4489 123.382 14.25C123.126 14.0511 122.807 13.9517 122.423 13.9517C122.054 13.9517 121.741 14.0469 121.486 14.2372C121.233 14.4276 121.041 14.6932 120.911 15.0341C120.78 15.375 120.714 15.7727 120.714 16.2273ZM126.872 21.9545V12.9545H128.116V14.0156H128.223C128.297 13.8793 128.403 13.7216 128.543 13.5426C128.682 13.3636 128.875 13.2074 129.122 13.0739C129.369 12.9375 129.696 12.8693 130.102 12.8693C130.631 12.8693 131.102 13.0028 131.517 13.2699C131.932 13.5369 132.257 13.9219 132.493 14.4247C132.732 14.9276 132.851 15.5327 132.851 16.2401C132.851 16.9474 132.733 17.554 132.497 18.0597C132.261 18.5625 131.938 18.9503 131.526 19.223C131.114 19.4929 130.643 19.6278 130.115 19.6278C129.717 19.6278 129.392 19.5611 129.139 19.4276C128.889 19.294 128.693 19.1378 128.551 18.9588C128.409 18.7798 128.3 18.6207 128.223 18.4815H128.146V21.9545H126.872ZM128.121 16.2273C128.121 16.6875 128.188 17.0909 128.321 17.4375C128.455 17.7841 128.648 18.0554 128.901 18.2514C129.153 18.4446 129.463 18.5412 129.83 18.5412C130.21 18.5412 130.528 18.4403 130.784 18.2386C131.04 18.0341 131.233 17.7571 131.364 17.4077C131.497 17.0582 131.564 16.6648 131.564 16.2273C131.564 15.7955 131.499 15.4077 131.368 15.0639C131.24 14.7202 131.047 14.4489 130.788 14.25C130.533 14.0511 130.213 13.9517 129.83 13.9517C129.46 13.9517 129.148 14.0469 128.892 14.2372C128.639 14.4276 128.447 14.6932 128.317 15.0341C128.186 15.375 128.121 15.7727 128.121 16.2273ZM137.036 19.6321C136.422 19.6321 135.886 19.4915 135.429 19.2102C134.972 18.929 134.616 18.5355 134.364 18.0298C134.111 17.5241 133.984 16.9332 133.984 16.2571C133.984 15.5781 134.111 14.9844 134.364 14.4759C134.616 13.9673 134.972 13.5724 135.429 13.2912C135.886 13.0099 136.422 12.8693 137.036 12.8693C137.649 12.8693 138.185 13.0099 138.642 13.2912C139.099 13.5724 139.455 13.9673 139.707 14.4759C139.96 14.9844 140.087 15.5781 140.087 16.2571C140.087 16.9332 139.96 17.5241 139.707 18.0298C139.455 18.5355 139.099 18.929 138.642 19.2102C138.185 19.4915 137.649 19.6321 137.036 19.6321ZM137.04 18.5625C137.438 18.5625 137.767 18.4574 138.028 18.2472C138.29 18.0369 138.483 17.7571 138.608 17.4077C138.736 17.0582 138.8 16.6733 138.8 16.2528C138.8 15.8352 138.736 15.4517 138.608 15.1023C138.483 14.75 138.29 14.4673 138.028 14.2543C137.767 14.0412 137.438 13.9347 137.04 13.9347C136.639 13.9347 136.307 14.0412 136.043 14.2543C135.781 14.4673 135.587 14.75 135.459 15.1023C135.334 15.4517 135.271 15.8352 135.271 16.2528C135.271 16.6733 135.334 17.0582 135.459 17.4077C135.587 17.7571 135.781 18.0369 136.043 18.2472C136.307 18.4574 136.639 18.5625 137.04 18.5625ZM141.509 19.5V12.9545H142.74V13.9943H142.809C142.928 13.642 143.138 13.3651 143.439 13.1634C143.743 12.9588 144.087 12.8565 144.471 12.8565C144.55 12.8565 144.644 12.8594 144.752 12.8651C144.863 12.8707 144.949 12.8778 145.012 12.8864V14.1051C144.961 14.0909 144.87 14.0753 144.739 14.0582C144.608 14.0384 144.478 14.0284 144.347 14.0284C144.046 14.0284 143.777 14.0923 143.542 14.2202C143.309 14.3452 143.124 14.5199 142.988 14.7443C142.851 14.9659 142.783 15.2187 142.783 15.5028V19.5H141.509ZM149.556 12.9545V13.9773H145.981V12.9545H149.556ZM146.94 11.3864H148.214V17.5781C148.214 17.8253 148.251 18.0114 148.325 18.1364C148.399 18.2585 148.494 18.3423 148.61 18.3878C148.73 18.4304 148.859 18.4517 148.998 18.4517C149.1 18.4517 149.19 18.4446 149.267 18.4304C149.343 18.4162 149.403 18.4048 149.446 18.3963L149.676 19.4489C149.602 19.4773 149.497 19.5057 149.36 19.5341C149.224 19.5653 149.054 19.5824 148.849 19.5852C148.514 19.5909 148.201 19.5312 147.912 19.4062C147.622 19.2812 147.387 19.0881 147.208 18.8267C147.029 18.5653 146.94 18.2372 146.94 17.8423V11.3864ZM153.717 19.6321C153.072 19.6321 152.516 19.4943 152.05 19.2188C151.587 18.9403 151.229 18.5497 150.977 18.0469C150.727 17.5412 150.602 16.9489 150.602 16.2699C150.602 15.5994 150.727 15.0085 150.977 14.4972C151.229 13.9858 151.582 13.5866 152.033 13.2997C152.488 13.0128 153.019 12.8693 153.627 12.8693C153.996 12.8693 154.354 12.9304 154.701 13.0526C155.048 13.1747 155.359 13.3665 155.634 13.6278C155.91 13.8892 156.127 14.2287 156.286 14.6463C156.445 15.0611 156.525 15.5653 156.525 16.1591V16.6108H151.322V15.6562H155.276C155.276 15.321 155.208 15.0241 155.072 14.7656C154.935 14.5043 154.744 14.2983 154.496 14.1477C154.252 13.9972 153.965 13.9219 153.636 13.9219C153.278 13.9219 152.965 14.0099 152.698 14.1861C152.434 14.3594 152.229 14.5866 152.085 14.8679C151.942 15.1463 151.871 15.4489 151.871 15.7756V16.5213C151.871 16.9588 151.948 17.331 152.102 17.6378C152.258 17.9446 152.475 18.179 152.754 18.3409C153.032 18.5 153.357 18.5795 153.729 18.5795C153.971 18.5795 154.191 18.5455 154.39 18.4773C154.589 18.4062 154.761 18.3011 154.906 18.1619C155.05 18.0227 155.161 17.8509 155.238 17.6463L156.444 17.8636C156.347 18.2187 156.174 18.5298 155.924 18.7969C155.677 19.0611 155.366 19.267 154.991 19.4148C154.619 19.5597 154.194 19.6321 153.717 19.6321ZM160.389 19.6278C159.86 19.6278 159.389 19.4929 158.974 19.223C158.562 18.9503 158.238 18.5625 158.002 18.0597C157.77 17.554 157.653 16.9474 157.653 16.2401C157.653 15.5327 157.771 14.9276 158.007 14.4247C158.245 13.9219 158.572 13.5369 158.987 13.2699C159.402 13.0028 159.872 12.8693 160.397 12.8693C160.804 12.8693 161.13 12.9375 161.377 13.0739C161.627 13.2074 161.821 13.3636 161.957 13.5426C162.096 13.7216 162.204 13.8793 162.281 14.0156H162.358V10.7727H163.632V19.5H162.387V18.4815H162.281C162.204 18.6207 162.093 18.7798 161.949 18.9588C161.806 19.1378 161.61 19.294 161.36 19.4276C161.11 19.5611 160.787 19.6278 160.389 19.6278ZM160.67 18.5412C161.037 18.5412 161.346 18.4446 161.599 18.2514C161.855 18.0554 162.048 17.7841 162.179 17.4375C162.312 17.0909 162.379 16.6875 162.379 16.2273C162.379 15.7727 162.314 15.375 162.183 15.0341C162.052 14.6932 161.86 14.4276 161.608 14.2372C161.355 14.0469 161.042 13.9517 160.67 13.9517C160.287 13.9517 159.967 14.0511 159.711 14.25C159.456 14.4489 159.262 14.7202 159.132 15.0639C159.004 15.4077 158.94 15.7955 158.94 16.2273C158.94 16.6648 159.005 17.0582 159.136 17.4077C159.267 17.7571 159.46 18.0341 159.716 18.2386C159.974 18.4403 160.292 18.5412 160.67 18.5412ZM168.728 19.5V10.7727H170.002V14.0156H170.079C170.153 13.8793 170.26 13.7216 170.399 13.5426C170.538 13.3636 170.731 13.2074 170.978 13.0739C171.225 12.9375 171.552 12.8693 171.958 12.8693C172.487 12.8693 172.958 13.0028 173.373 13.2699C173.788 13.5369 174.113 13.9219 174.349 14.4247C174.588 14.9276 174.707 15.5327 174.707 16.2401C174.707 16.9474 174.589 17.554 174.353 18.0597C174.118 18.5625 173.794 18.9503 173.382 19.223C172.97 19.4929 172.5 19.6278 171.971 19.6278C171.574 19.6278 171.248 19.5611 170.995 19.4276C170.745 19.294 170.549 19.1378 170.407 18.9588C170.265 18.7798 170.156 18.6207 170.079 18.4815H169.973V19.5H168.728ZM169.977 16.2273C169.977 16.6875 170.044 17.0909 170.177 17.4375C170.311 17.7841 170.504 18.0554 170.757 18.2514C171.01 18.4446 171.319 18.5412 171.686 18.5412C172.066 18.5412 172.385 18.4403 172.64 18.2386C172.896 18.0341 173.089 17.7571 173.22 17.4077C173.353 17.0582 173.42 16.6648 173.42 16.2273C173.42 15.7955 173.355 15.4077 173.224 15.0639C173.096 14.7202 172.903 14.4489 172.645 14.25C172.389 14.0511 172.069 13.9517 171.686 13.9517C171.316 13.9517 171.004 14.0469 170.748 14.2372C170.495 14.4276 170.304 14.6932 170.173 15.0341C170.042 15.375 169.977 15.7727 169.977 16.2273ZM176.721 21.9545C176.53 21.9545 176.357 21.9389 176.201 21.9077C176.044 21.8793 175.928 21.848 175.851 21.8139L176.158 20.7699C176.391 20.8324 176.598 20.8594 176.78 20.8509C176.962 20.8423 177.123 20.7741 177.262 20.6463C177.404 20.5185 177.529 20.3097 177.637 20.0199L177.794 19.5852L175.4 12.9545H176.763L178.421 18.0341H178.489L180.147 12.9545H181.515L178.817 20.3736C178.692 20.7145 178.533 21.0028 178.34 21.2386C178.147 21.4773 177.917 21.6563 177.65 21.7756C177.382 21.8949 177.073 21.9545 176.721 21.9545Z"
              fill="white"/>
          <path fill-rule="evenodd" clip-rule="evenodd"
                d="M233.091 10.2005L233.091 10.2L233.092 10.2005H233.092V10.2014L237.128 17.145H239.25V19.7489H230.971V17.145H232.66L232.224 16.392L228.282 16.3929L227.778 17.1449H229.445V19.7489H222.259V17.1449H224.509L227.398 12.8046H225.37V10.2005H233.091ZM231.188 14.6113L230.37 13.2079L229.44 14.6178L231.188 14.6113Z"
                fill="white"/>
          <path
              d="M187.149 10.2006H192.768V10.2079L196.325 13.9554L199.862 10.2022V10.2006H205.502V12.8047H204.335V17.1448H205.902V19.7489H198.716V17.1448H200.283V14.5944L197.68 17.162H194.971L192.369 14.5951V17.1449H193.936V19.749H186.75V17.1449H188.317V12.8047H187.149V10.2006Z"
              fill="white"/>
          <path d="M217.313 17.1542H221.366V10.2005H217.313V17.1542Z" fill="white"/>
          <path d="M207.771 17.1786V10.2006H211.825V17.1541H217.309V19.7834H211.823L207.771 17.1786Z" fill="white"/>
        </g>
      </svg>
    </div>
  </n-flex>
</template>

<style>

.vertical {
  display: flex;
  height: 100%;
  width: 100%;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 1em;

  .header {
    position: absolute;
    top: 0;
    width: auto;
    height: 3em;
    justify-content: space-between;
    padding: 2em;

    img {
      width: 61px;
    }
  }

  .galacean {
    border-radius: 1em;
    height: calc(100% - 1.5em);
    width: calc(100% - 2em);
    padding-left: 1em;
    padding-top: 1em;
  }

  .model-div {
    display: flex;
    height: 40%;
    width: 100%;
  }

  .ui {
    display: flex;
    width: 100%;
    height: calc(60% - 6em);
  }

  .footer {
    display: flex;
    flex-direction: row;
    justify-content: center;
    width: 100%;
    align-items: center;
    height: 4em;
  }
}

.horizontal {
  display: flex;
  flex-direction: row;
  align-items: end;
  justify-content: center;
  height: 100%;
  width: 100%;
  gap: 0;

  .header {
    position: absolute;
    width: calc(100% - 2em);
    height: 3em;
    top: 0.5em;
    left: 0;
    display: flex;
    flex-direction: row;
    justify-content: start;
    align-items: center;
    padding-left: 1em;
    padding-right: 1em;

    img {
      width: 61px;
    }
  }

  .model-div {
    display: flex;
    height: calc(100% - 4em);
    width: 40%;
    justify-content: center;
    align-items: start;
    border-radius: 1em;
  }

  .galacean {
    border-radius: 1em;
    height: calc(100% - 1em);
    width: calc(100% - 0.5em);
    padding-left: 0.5em;
  }

  .ui {
    display: flex;
    width: calc(60% - 1em);
    height: calc(100% - 5em);
    padding-bottom: 1em;
  }

  .footer {
    display: flex;
    justify-content: center;
    position: absolute;
    pointer-events: none;
    bottom: 2em;
    scale: 1.5;
    width: 40%;
    left: 0;
  }
}


.chat-panel {
  width: calc(100% - 5em);
  padding-left: 2em;
  padding-right: 2em;
  height: 100%;
  border-radius: 1em;
  background-color: #22252E;

  .char-name {
    height: 2em;
    width: auto;
    color: white;
    font-weight: bold;
    font-size: 1em;
    top: 1em;
    padding: 1em;
  }

  .history-container {
    width: 100%;
    height: calc(100% - 10em);
    overflow-y: scroll;
    scrollbar-width: none;
    background-color: rgba(0, 0, 0, 0);
  }

  .input-container {
    width: 100%;
    height: 6em;

    input {
      background-color: rgba(255, 255, 255, 0);
      outline-color: rgba(255, 255, 255, 0);
      border-color: rgba(255, 255, 255, 0);
      color: white;
    }
  }
}
</style>